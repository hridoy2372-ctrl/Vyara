<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monetag Rewarded Ads — Demo</title>

  <!-- Monetag SDK (zone 9817616) -->
  <script src="//libtl.com/sdk.js" data-zone="9817616" data-sdk="show_9817616"></script>

  <style>
    :root {
      --bg1: #071124;
      --bg2: #0b3b59;
      --accent: #00e676;
      --muted: #bfc8cf;
    }
    * { box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color: #fff;
      padding:20px;
    }
    .card{
      width:100%;
      max-width:520px;
      background: rgba(255,255,255,0.03);
      border-radius:14px;
      padding:22px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.04);
    }
    h1 { margin:0 0 12px 0; font-size:20px; color:var(--accent); }
    p { margin:0 0 14px 0; color:var(--muted); font-size:14px; }
    .btn {
      display:inline-block;
      width:100%;
      padding:12px 14px;
      margin:8px 0;
      border-radius:10px;
      background: linear-gradient(90deg,var(--accent), #00c853);
      border:none;
      color:#000;
      font-weight:700;
      cursor:pointer;
      font-size:15px;
      transition:transform .12s ease, opacity .12s ease;
    }
    .btn:active{ transform: translateY(2px); }
    .btn[disabled]{
      opacity:.45;
      cursor:not-allowed;
      transform:none;
      background: rgba(255,255,255,0.06);
      color: #bbb;
    }
    .row { display:flex; gap:10px; }
    .small { font-size:13px; color:var(--muted); margin-top:8px; }
    .status {
      padding:8px 10px;
      border-radius:8px;
      background: rgba(255,255,255,0.02);
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
    }
    .points{
      margin-top:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .badge {
      background: rgba(255,255,255,0.03);
      padding:8px 12px;
      border-radius:12px;
      font-weight:700;
      color:var(--accent);
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Monetag Rewarded Ads — Demo</h1>
    <p>Zone ID: <strong>9817616</strong> · SDK: <code>show_9817616</code></p>

    <div class="status" id="sdk-status">SDK status: <strong id="sdk-state">Checking...</strong></div>

    <!-- Buttons -->
    <button id="popup-btn" class="btn" disabled>Show Rewarded Popup (pop)</button>
    <button id="inter-btn" class="btn" disabled>Show Rewarded Interstitial</button>

    <div class="points">
      <div class="small">Watched Ads: <span id="watched-count">0</span></div>
      <div class="badge">Points: <span id="points">0.00</span></div>
    </div>

    <p class="small">Note: Buttons become active only after SDK is detected. If SDK fails to load, demo fallback will simulate ads so you can test reward flow.</p>
  </div>

  <script>
    // CONFIG
    const ZONE_FN = 'show_9817616'; 
    const SDK_POLL_INTERVAL = 300; 
    const SDK_POLL_TIMEOUT = 8000; 
    const POINTS_PER_AD = 0.50;
    const AUTO_INTERVAL = 6000; // 6 seconds silent auto

    // UI
    const sdkStateEl = document.getElementById('sdk-state');
    const popupBtn = document.getElementById('popup-btn');
    const interBtn = document.getElementById('inter-btn');
    const watchedCountEl = document.getElementById('watched-count');
    const pointsEl = document.getElementById('points');

    // State
    let sdkAvailable = false;
    let watched = parseInt(localStorage.getItem('watched') || '0', 10);
    let points = parseFloat(localStorage.getItem('points') || '0');

    watchedCountEl.textContent = watched;
    pointsEl.textContent = points.toFixed(2);

    function setButtonsEnabled(enabled) {
      popupBtn.disabled = !enabled;
      interBtn.disabled = !enabled;
      if (enabled) {
        popupBtn.style.opacity = 1;
        interBtn.style.opacity = 1;
      }
    }

    function checkSdkReady() {
      return (typeof window[ZONE_FN] === 'function');
    }

    function waitForSdk(timeout = SDK_POLL_TIMEOUT) {
      const start = Date.now();
      return new Promise((resolve) => {
        function poll() {
          if (checkSdkReady()) {
            sdkAvailable = true;
            sdkStateEl.textContent = 'Loaded ✓';
            resolve(true);
          } else if (Date.now() - start > timeout) {
            sdkAvailable = false;
            sdkStateEl.textContent = 'Not found — using fallback (demo)';
            resolve(false);
          } else {
            sdkStateEl.textContent = 'Waiting for SDK...';
            setTimeout(poll, SDK_POLL_INTERVAL);
          }
        }
        poll();
      });
    }

    function rewardUser(amount) {
      watched += 1;
      points = parseFloat((points + amount).toFixed(2));
      localStorage.setItem('watched', watched);
      localStorage.setItem('points', points);
      watchedCountEl.textContent = watched;
      pointsEl.textContent = points.toFixed(2);
    }

    function callSdkInterstitial() {
      if (sdkAvailable) {
        try {
          // Silent auto Interstitial using Monetag inAppSettings
          return window[ZONE_FN]({
            type: 'inApp',
            inAppSettings: {
              frequency: 2,
              capping: 0.1,
              interval: 30,
              timeout: 5,
              everyPage: false
            }
          });
        } catch (e) {
          return Promise.reject(e);
        }
      } else {
        return new Promise((res) => {
          setTimeout(res, 2500); // fallback simulated ad
        });
      }
    }

    async function showInterstitialAuto() {
      try {
        await callSdkInterstitial();
        rewardUser(POINTS_PER_AD);
      } catch (err) {
        console.error('Auto Interstitial error', err);
      }
    }

    // Manual button handlers
    popupBtn.addEventListener('click', async () => {
      setButtonsEnabled(false);
      try {
        if (sdkAvailable) await window[ZONE_FN]('pop');
        else await new Promise(res => setTimeout(res, 2000));
        rewardUser(POINTS_PER_AD);
      } finally {
        setButtonsEnabled(true);
      }
    });

    interBtn.addEventListener('click', async () => {
      setButtonsEnabled(false);
      try {
        await showInterstitialAuto();
      } finally {
        setButtonsEnabled(true);
      }
    });

    // Init
    (async function init() {
      setButtonsEnabled(false);
      const ok = await waitForSdk();
      setButtonsEnabled(true);
      if (ok) sdkStateEl.textContent = 'SDK loaded — ready to show ads ✓';
      else sdkStateEl.textContent = 'SDK not found — demo fallback active';
      // Start silent auto interstitial every 6 seconds
      setInterval(showInterstitialAuto, AUTO_INTERVAL);
    })();
  </script>
</body>
</html>
